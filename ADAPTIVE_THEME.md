# 自适应主题功能说明

## 🎨 功能介绍

WordGet 现在支持**自适应页面色调**功能！侧边栏会自动检测您当前浏览页面的主色调，并调整自身的配色方案以更好地融入页面，提供更和谐的视觉体验。

## ✨ 特性

### 智能色彩检测
- 🔍 自动分析页面的主要配色
- 🎯 提取最多3种主导色彩
- 🌓 自动识别深色/浅色模式
- 🎨 过滤灰度色，保留有彩色

### 动态主题适配
- **主色调 (Primary)**: 从页面中提取的最常用颜色
- **次色调 (Secondary)**: 第二常用的颜色
- **强调色 (Accent)**: 第三常用的颜色，用于成功提示等
- **深色模式**: 自动检测页面是否使用深色背景

### 视觉效果
- 渐变标题栏自动匹配页面色调
- 按钮和链接颜色自动调整
- 深色模式下文字、背景、阴影全面适配
- 平滑的颜色过渡效果

## 🚀 使用方法

### 启用功能

1. 点击浏览器工具栏的 WordGet 图标打开侧边栏
2. 点击右上角的设置按钮 ⚙️
3. 在"行为设置"部分找到 **"自适应页面色调"**
4. 确保该选项已勾选 ✅（默认启用）

### 自动检测时机

侧边栏会在以下情况下自动检测和应用页面主题：

1. **点击扩展图标** 打开侧边栏时
2. **使用快捷键** (`Ctrl+Shift+S`) 保存单词时
3. **使用右键菜单** 保存单词时
4. **初次加载** 侧边栏时（应用上次检测的主题）

### 测试效果

尝试在不同风格的网站上打开侧边栏：

**浅色网站示例**：
- Google.com - 简洁白色
- Wikipedia.org - 经典维基风格
- GitHub.com（浅色模式）- 清新蓝绿色

**深色网站示例**：
- GitHub.com（深色模式）- 深邃黑色
- YouTube.com（深色模式）- 深灰色
- Reddit.com（深色模式）- 深蓝黑色

**彩色网站示例**：
- Dribbble.com - 粉红色调
- Behance.net - 蓝色调
- Medium.com - 绿色调

## 🎯 工作原理

### 1. 页面分析
```
扫描页面元素 → 提取颜色 → 统计频率 → 排序筛选
```

扩展会：
- 采样页面上的元素（最多100个）
- 提取背景色、文字色、边框色
- 过滤掉透明色和灰度色
- 统计每种颜色的出现频率

### 2. 颜色处理
```
RGB解析 → 灰度检测 → 颜色分组 → 选择主色
```

智能算法：
- 将相近的颜色归为一组（±20的RGB范围）
- 排除黑白灰等无彩色
- 选择出现最频繁的3种颜色

### 3. 主题生成
```
检测亮度 → 判断深浅 → 生成配色 → 应用样式
```

自动调整：
- 浅色页面 → 浅色侧边栏 + 深色文字
- 深色页面 → 深色侧边栏 + 浅色文字
- 主色调用于标题栏渐变
- 次色调用于按钮和链接

### 4. 样式应用
```
CSS变量 → 动态更新 → 平滑过渡
```

使用CSS自定义属性：
```css
--primary: 检测到的主色
--secondary: 检测到的次色
--text-primary: 自动调整的文字色
--bg-primary: 自动调整的背景色
```

## ⚙️ 技术细节

### 支持的颜色格式
- `rgb(r, g, b)`
- `rgba(r, g, b, a)`

### 采样策略
- 最多采样 100 个页面元素
- 均匀分布采样（避免偏向某个区域）
- 最多收集 150 种颜色
- 分组粒度：20 RGB单位

### 亮度计算
使用相对亮度公式：
```
L = 0.299 * R + 0.587 * G + 0.114 * B
```
- L < 0.5 → 深色模式
- L ≥ 0.5 → 浅色模式

### 灰度检测
检测 RGB 三个通道的差异：
```
Max(|R-G|, |G-B|, |B-R|) < 30 → 灰度色
```

## 🎨 深色模式适配

当检测到深色页面时，侧边栏会自动调整：

| 元素 | 浅色模式 | 深色模式 |
|------|---------|---------|
| 文字（主要） | #1a1a1a | #e8e8e8 |
| 文字（次要） | #666666 | #b0b0b0 |
| 文字（第三） | #999999 | #888888 |
| 背景（主要） | #ffffff | #1a1a1a |
| 背景（次要） | #f8f9fa | #242424 |
| 背景（第三） | #f0f2f5 | #2a2a2a |
| 边框 | #e1e4e8 | #3a3a3a |
| 阴影 | 浅色半透明 | 深色半透明 |

## 🔧 自定义与扩展

### 禁用自适应主题

如果您更喜欢固定的配色方案：

1. 打开侧边栏设置
2. 取消勾选 "自适应页面色调"
3. 侧边栏将使用默认的蓝紫渐变主题

### 手动刷新主题

如果页面主题改变了（如切换深浅模式）：

1. 关闭并重新打开侧边栏
2. 或使用快捷键保存一个单词
3. 主题会自动重新检测

### 默认主题

当自适应主题禁用或检测失败时，使用默认配色：

- **主色**: `#667eea` (优雅紫蓝)
- **次色**: `#764ba2` (神秘紫色)
- **强调色**: `#48bb78` (清新绿色)
- **模式**: 浅色

## 📊 兼容性

### 浏览器要求
- Chrome 114+ ✅
- Edge 114+ ✅
- 需要 `scripting` 权限

### 页面类型
- ✅ 普通网页
- ✅ HTTPS 网站
- ✅ HTTP 网站
- ✅ 本地文件 (file://)
- ❌ Chrome 内部页面 (chrome://)
- ❌ 扩展页面 (chrome-extension://)

### 性能影响
- 颜色检测时间：< 100ms
- CPU 占用：极低
- 内存占用：可忽略
- 不影响页面性能

## 🐛 故障排除

### 主题没有改变

1. **检查设置**
   - 确认"自适应页面色调"已启用

2. **刷新侧边栏**
   - 关闭侧边栏后重新打开

3. **检查页面类型**
   - Chrome 内部页面不支持
   - 某些特殊页面可能无权限

4. **查看控制台**
   - 按 F12 打开开发者工具
   - 查看是否有错误信息

### 颜色不准确

可能原因：
- 页面使用了大量图片（图片颜色不被检测）
- 页面使用了复杂的 CSS（如渐变、滤镜）
- 页面动态加载内容

解决方案：
- 等待页面完全加载后再打开侧边栏
- 禁用自适应主题，使用默认配色

### 深浅模式判断错误

如果侧边栏的深浅模式与页面不匹配：
- 可能是页面背景透明
- 可能是页面使用了特殊的配色
- 建议禁用自适应主题

## 💡 最佳实践

1. **在视觉风格明显的网站使用**
   - 效果更明显
   - 融合度更好

2. **深色模式网站特别推荐**
   - 避免浅色侧边栏的刺眼感
   - 提供一致的阅读体验

3. **定期导出数据**
   - 主题设置会保存
   - 但建议定期备份单词数据

4. **性能考虑**
   - 主题检测非常轻量
   - 不会影响浏览器性能
   - 可放心使用

## 🎓 示例场景

### 场景1: 阅读技术文档
```
GitHub Docs (深色) → WordGet 自动切换深色主题
背景: #0d1117 → 侧边栏背景: #1a1a1a
文字: #c9d1d9 → 侧边栏文字: #e8e8e8
主色: 蓝色调 → 标题栏: 蓝色渐变
```

### 场景2: 浏览设计网站
```
Dribbble (粉色调) → WordGet 采用粉色主题
主色: 粉红 → 标题栏: 粉红渐变
次色: 紫色 → 按钮: 紫色
强调色: 橙色 → 成功提示: 橙色
```

### 场景3: 阅读新闻
```
BBC News (红白配色) → WordGet 红色主题
主色: BBC红 → 标题栏: 红色渐变
背景: 白色 → 侧边栏: 浅色模式
文字: 深灰 → 文字: 深色
```

## 🔄 版本历史

### v1.0.1 (2025-10-25)
- ✨ 新增：自适应页面色调功能
- ✨ 新增：智能深浅模式检测
- ✨ 新增：主题设置选项
- 🔧 优化：颜色检测算法
- 🔧 优化：CSS 变量系统
- 📝 新增：主题适配文档

## 📞 反馈与建议

如果您有任何关于主题功能的建议：

- 🐛 报告颜色检测问题
- 💡 建议新的配色方案
- 🎨 分享您喜欢的主题效果
- 📊 反馈性能问题

请访问：https://github.com/TTAWDTT/WordGet/issues

---

**让 WordGet 完美融入您的浏览体验！** 🎨✨
