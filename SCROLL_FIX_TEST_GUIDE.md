# 滚动同步修复测试指南

## 问题描述
在翻译阅读模式下，当页面滚动时，翻译提示框的位置不会同步更新，导致提示框停留在原来的视口位置。

## 修复方案
在 `modules/tooltip-ui.js` 中添加了滚动事件监听器，当页面滚动时自动更新提示框位置。

## 测试步骤

### 准备工作
1. 在 Chrome/Edge 浏览器中加载扩展
   - 打开 `chrome://extensions/`
   - 启用"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择 WordGet 项目文件夹

### 测试 1: 基本滚动同步
1. 打开 `test-long-page.html` 测试页面
2. 按 `Ctrl+Q` 开启翻译阅读模式
3. 选中 Section 1 中的文本 "artificial intelligence"
4. 等待翻译提示框出现
5. **滚动页面向下**
6. ✅ **预期结果**: 提示框应该随着页面滚动同步移动，保持与选中文本的相对位置

### 测试 2: 不同滚动位置
1. 保持翻译阅读模式开启
2. 滚动到页面中间位置（Section 3 左右）
3. 选中 "Convolutional Neural Networks"
4. 观察提示框位置
5. **向上或向下滚动**
6. ✅ **预期结果**: 提示框应该跟随滚动移动

### 测试 3: 页面底部
1. 滚动到页面最底部（Section 6）
2. 选中 "translation tooltip appears"
3. 等待提示框出现
4. **向上滚动**
5. ✅ **预期结果**: 提示框应该向上移动，保持与文本的相对位置

### 测试 4: 快速滚动
1. 在任意位置选中文本显示提示框
2. **快速滚动页面**（使用鼠标滚轮或拖动滚动条）
3. ✅ **预期结果**: 提示框应该流畅地跟随滚动，没有明显延迟或卡顿

### 测试 5: 边界情况
1. 选中页面顶部的文本
2. 向下滚动直到选中的文本滚出视口
3. ✅ **预期结果**: 提示框应该根据滚动偏移调整位置，如果超出视口边界应该自动调整到合适位置

### 测试 6: 多次选择
1. 选中文本 A，显示提示框
2. 滚动页面
3. 选中新的文本 B
4. ✅ **预期结果**: 
   - 文本 A 的提示框应该隐藏
   - 文本 B 的提示框应该出现在正确位置
   - 继续滚动时，新提示框应该正常跟随

### 测试 7: 横向滚动（如果页面支持）
1. 如果页面有横向滚动，选中文本
2. **横向滚动页面**
3. ✅ **预期结果**: 提示框应该同时跟随横向和纵向滚动

## 调试技巧

### 启用调试日志
在浏览器控制台中运行：
```javascript
window.wordgetDebug = true
```

然后执行测试步骤，控制台会显示详细的定位信息。

### 检查关键信息
调试日志会显示：
- 鼠标位置
- Tooltip 尺寸
- 视口尺寸
- 滚动偏移量
- 最终计算的位置

## 成功标准
- ✅ 提示框在所有滚动位置都能正确显示
- ✅ 滚动时提示框位置同步更新
- ✅ 没有明显的性能问题或卡顿
- ✅ 在快速滚动时表现流畅
- ✅ 边界情况处理正确（不会超出视口）

## 已知限制
- 提示框使用 `position: fixed` 定位，相对于视口而非页面
- 滚动监听器在提示框显示时添加，隐藏后移除
- 极快的滚动可能导致短暂的位置延迟（由浏览器的事件处理机制决定）

## 修复的技术细节

### 关键变更
1. 在 `TooltipUI` 构造函数中添加：
   - `scrollBound` 绑定的滚动处理函数
   - `originalX`, `originalY` 存储初始坐标
   - `scrollX`, `scrollY` 存储初始滚动位置

2. 在 `show()` 方法中：
   - 记录显示时的原始坐标和滚动位置

3. 在 `addEventListeners()` 和 `removeEventListeners()` 中：
   - 添加/移除滚动事件监听器

4. 新增 `handleScroll()` 方法：
   - 计算滚动偏移量（delta）
   - 根据偏移量调整提示框位置
   - 调用 `updatePosition()` 更新显示

### 位置计算逻辑
```
当前滚动位置 = window.scrollY
滚动偏移量 = 当前滚动位置 - 初始滚动位置
调整后的 Y 坐标 = 原始 Y 坐标 - 滚动偏移量
```

这样确保提示框相对于页面内容的位置保持不变。
