# 侧边栏调试指南

## 如何测试侧边栏是否正常工作

### 1. 检查浏览器版本
- Chrome 114+ 支持基础的 Side Panel API
- Chrome 116+ 支持 tabId 方式打开
- Edge 基于 Chromium 也支持，需要114+版本

### 2. 测试步骤

#### 测试方法1：点击扩展图标
1. 在任意网页点击浏览器工具栏上的 WordGet 图标
2. 侧边栏应该立即打开
3. 查看浏览器控制台（F12）的日志：
   - `🖱️ 用户点击了扩展图标`
   - `🚪 开始尝试打开侧边栏...`
   - `✅ 侧边栏已通过 windowId 打开` 或其他成功消息

#### 测试方法2：快捷键保存单词
1. 在网页上选中一个单词
2. 按 `Ctrl+Shift+S`（Mac: `Cmd+Shift+S`）
3. 应该看到：
   - 单词被保存
   - 侧边栏自动打开（如果设置中启用了自动打开）
4. 查看控制台日志：
   - `⌨️ 用户按下了保存单词快捷键`
   - `🚪 尝试自动打开侧边栏...`
   - `✅ 侧边栏已自动打开`

#### 测试方法3：右键菜单
1. 选中文字后右键
2. 选择"保存到 WordGet"
3. 侧边栏应该打开

### 3. 查看后台日志

打开扩展的后台页面查看详细日志：
1. 访问 `chrome://extensions/`
2. 找到 WordGet 扩展
3. 点击"检查视图" → "Service Worker"
4. 查看控制台输出

### 4. 常见问题排查

#### 问题：侧边栏完全不打开
**可能原因**：
- 浏览器版本太旧（需要 Chrome 114+）
- Side Panel API 不可用

**检查方法**：
在扩展后台控制台运行：
```javascript
console.log('sidePanel API:', chrome.sidePanel);
console.log('sidePanel.open:', typeof chrome.sidePanel?.open);
```

应该看到：
```
sidePanel API: Object { ... }
sidePanel.open: function
```

如果看到 `undefined`，说明浏览器不支持。

#### 问题：第一次打开失败，需要点击多次
**原因**：这是 API 的已知问题，特别是在某些 Chrome 版本中

**解决方法**：代码已包含自动重试机制，会在失败后：
- 等待 200ms
- 重试打开
- 如果还失败，会连续尝试3次

#### 问题：点击图标没反应
**排查步骤**：
1. 检查控制台是否有 `🖱️ 用户点击了扩展图标` 日志
2. 如果没有，说明事件监听器没有注册成功
3. 尝试重新加载扩展

### 5. 强制刷新扩展

如果修改了代码，必须：
1. 访问 `chrome://extensions/`
2. 找到 WordGet
3. 点击刷新按钮 🔄
4. 关闭所有之前打开的侧边栏
5. 重新测试

### 6. 应急方案

如果侧边栏始终无法自动打开，可以：
1. 手动点击扩展图标打开侧边栏
2. 保持侧边栏开启状态
3. 使用快捷键保存单词时，新单词会自动显示在已打开的侧边栏中

### 7. 查看完整调试信息

最新版本的代码包含了详细的 emoji 日志，方便追踪执行流程：
- 🖱️ 用户操作
- 🚪 尝试打开
- ✅ 成功
- ⚠️ 警告/重试
- ❌ 失败
- 🎯 检测到
- 📞 消息传递
- 💾 存储操作

所有这些日志都会显示在扩展的后台控制台中。

## 紧急修复

如果侧边栏仍然无法打开，可以临时禁用自动打开功能：
1. 打开侧边栏（点击扩展图标）
2. 点击设置图标
3. 取消勾选"保存单词后自动打开侧边栏"
4. 这样单词仍会保存，但不会尝试自动打开
5. 需要查看时手动点击图标打开即可
